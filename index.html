<!DOCTYPE html>
<html lang="ko">
<head>
  <meta name="robots" content="index, follow">
  <meta name="description" content="ì†Œë‚™ì˜ ê°ë„ ë³´ì •ì‚¬ ğŸ¯ ë°°í‹€ê·¸ë¼ìš´ë“œ ê°ë„ ë¶„ì„ ë„êµ¬. ë§‰ì°½ìƒ·ì—ì„œ ë ˆì´ì €ê¹Œì§€, ê°ë„ ë¬¸ì œë¥¼ í•´ê²°í•˜ì„¸ìš”!">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì†Œë‚™ì˜ ê°ë„ ì¡°ì •ì‚¬</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-color: #005F9E;
      --accent-color: #00A3E0;
      --bg-color: #F5F7FA;
      --card-bg: #FFFFFF;
      --text-color: #1A202C;
      --subtext-color: #6B7280;
      --border-radius: 12px;
      --spacing: 1.5rem;
      --shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg-color);
      color: var(--text-color);
      line-height: 1.6;
    }
    .site-header {
      background: linear-gradient(135deg, var(--primary-color) 0%, #003F6B 100%);
      height: 5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow);
      padding: 0 1rem;
    }
    .main-container {
      max-width: 1200px;
      margin: var(--spacing) auto;
      display: flex;
      gap: 2rem;
      padding: 0 var(--spacing);
    }
    .input-container {
      flex: 1;
      max-width: 600px;
      background: var(--card-bg);
      border-radius: var(--border-radius);
      padding: var(--spacing);
      box-shadow: var(--shadow);
    }
    .explanation-container {
      flex: 1;
      max-width: 500px;
      background: #E6F0FA;
      border-radius: var(--border-radius);
      padding: var(--spacing);
      box-shadow: var(--shadow);
    }
    h1 { display: none; }
    h2 {
      font-size: 1.5rem;
      margin-top: 2rem;
      margin-bottom: var(--spacing);
      color: var(--text-color);
      font-weight: 600;
    }
    .explanation-container h2 {
      font-size: 1.3rem;
    }
    .form-group { margin-bottom: var(--spacing); }
    label {
      display: block;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--text-color);
    }
    input[type=number], select {
      width: 100%;
      padding: 0.875rem;
      border: 1px solid #D1D5DB;
      border-radius: var(--border-radius);
      background: #F9FAFB;
      font-size: 1rem;
      color: var(--text-color);
      transition: border-color 0.3s, box-shadow 0.3s;
    }
    input[type=number]:focus, select:focus {
      outline: none;
      border-color: var(--accent-color);
      box-shadow: 0 0 0 3px rgba(0, 163, 224, 0.2);
    }
    .file-drop {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      padding: 2.5rem;
      border: 2px dashed #D1D5DB;
      border-radius: var(--border-radius);
      background: #F9FAFB;
      cursor: pointer;
      transition: border-color 0.3s, background 0.3s;
    }
    .file-drop.dragover {
      border-color: var(--accent-color);
      background: rgba(0, 163, 224, 0.1);
    }
    .plus-icon {
      font-size: 1.5rem;
      color: var(--subtext-color);
      margin-bottom: 0.75rem;
    }
    #file-list {
      margin-top: 0.75rem;
      color: var(--subtext-color);
      font-size: 0.95rem;
    }
    #preview-container {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      margin-top: 1.5rem;
    }
    .preview-thumb {
      position: relative;
      flex: 0 0 100px;
      height: 56px;
      border-radius: var(--border-radius);
      overflow: hidden;
      background: #000;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    .preview-thumb video {
      width: 100%;
      height: 100%;
      object-fit: cover;
      opacity: 0.9;
    }
    .delete-btn {
      position: absolute;
      top: 4px;
      right: 4px;
      background: #EF4444;
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background 0.2s;
    }
    .delete-btn:hover {
      background: #B91C1C;
    }
    button {
      width: 100%;
      padding: 1rem;
      margin-top: var(--spacing);
      font-size: 1.1rem;
      font-weight: 600;
      color: #fff;
      background: var(--accent-color);
      border: none;
      border-radius: var(--border-radius);
      cursor: pointer;
      transition: background 0.3s, transform 0.2s, box-shadow 0.3s;
    }
    button:disabled {
      background: #D1D5DB;
      cursor: not-allowed;
    }
    button:not(:disabled):hover {
      background: #0086B3;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 163, 224, 0.3);
    }
    .form-group-inline {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    .form-group-inline small {
      max-width: 400px;
      color: var(--subtext-color);
      font-size: 0.9rem;
      line-height: 1.4;
    }
    .box {
      background: #F9FAFB;
      padding: var(--spacing);
      border-radius: var(--border-radius);
      border: 2px solid var(--accent-color);
      margin-top: var(--spacing);
      box-shadow: var(--shadow);
      transition: background 0.2s;
    }
    .box:hover {
      background: #E6F0FA;
    }
    #analysis-result {
      font-size: 1rem;
      color: var(--text-color);
    }
    .result-explanation {
      margin-top: 1rem;
      font-size: 0.95rem;
      color: var(--subtext-color);
      border-top: 1px solid #D1D5DB;
      padding-top: 1rem;
    }
    .copy-btn {
      display: inline-block;
      margin-top: 1rem;
      padding: 0.5rem 1rem;
      background: var(--primary-color);
      color: #fff;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 600;
      transition: background 0.2s;
    }
    .copy-btn:hover {
      background: #003F6B;
    }
    .copy-fallback {
      margin-top: 1rem;
      display: none;
      width: 100%;
      padding: 0.5rem;
      font-size: 0.9rem;
      background: #F9FAFB;
      border: 1px solid #D1D5DB;
      border-radius: var(--border-radius);
    }
    .link-back {
      display: flex;
      justify-content: flex-end;
      margin-top: var(--spacing);
    }
    .link-back a {
      color: var(--accent-color);
      text-decoration: none;
      font-weight: 600;
      transition: color 0.2s;
    }
    .link-back a:hover {
      color: #0086B3;
    }
    .chart-container {
      margin-top: var(--spacing);
    }
    canvas {
      border-radius: var(--border-radius);
      background: #fff;
      box-shadow: var(--shadow);
    }
    .main-heading {
      font-size: 1.8rem;
      font-weight: 700;
      color: #fff;
      text-align: center;
      display: flex;
      align-items: center;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: 100%;
    }
    .sub-heading {
      font-size: 0.95rem;
      font-weight: 400;
      color: #E6F0FA;
      text-align: center;
      margin-top: 0.25rem;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: normal;
      max-width: 100%;
    }
    .target-icon {
      background: var(--accent-color);
      border-radius: 6px;
      padding: 0.2rem 0.4rem;
      margin-left: 0.5rem;
      font-size: 1.5rem;
      display: inline-block;
      line-height: 1;
    }
    .side-note {
      max-width: 600px;
      margin: 2rem auto;
      padding: 1.75rem;
      background: #E6F0FA;
      border: 2px solid var(--accent-color);
      border-radius: var(--border-radius);
      font-size: 0.95rem;
      color: var(--text-color);
      box-shadow: var(--shadow);
    }
    @media (max-width: 900px) {
      .main-container {
        flex-direction: column;
      }
      .input-container, .explanation-container {
        max-width: 100%;
      }
    }
    @media (max-width: 600px) {
      .site-header {
        height: 6rem;
      }
      .main-heading {
        font-size: 1.5rem;
      }
      .sub-heading {
        font-size: 0.85rem;
        margin-top: 0.5rem;
      }
      .target-icon {
        font-size: 1.2rem;
        padding: 0.15rem 0.3rem;
      }
      .form-group-inline {
        flex-direction: column;
        align-items: flex-start;
      }
      .form-group-inline small {
        max-width: 100%;
      }
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div style="display: flex; flex-direction: column; align-items: center;">
      <div class="main-heading">ì†Œë‚™ì˜ ê°ë„ ë³´ì •ì‚¬ <span class="target-icon">ğŸ¯</span></div>
      <div class="sub-heading">ë§‰ì°½ìƒ·ë“¤ ë“œë£¨ì™€, ë ˆì´ì €ë¡œ ê°€ì¦ˆì•„!</div>
    </div>
  </header>
  <div class="main-container">
    <div class="input-container">
      <h1>ì†Œë‚™ì˜ ê°ë„ ì¡°ì •ì‚¬</h1>
      <h2>ì‚¬ìš©ì ê°ë„ ì„¤ì •</h2>
      <div class="form-group">
        <label for="dpi-input">í˜„ì¬ DPI</label>
        <select id="dpi-input">
          <option>400</option><option>800</option><option>1200</option><option>1800</option><option>3200</option>
        </select>
      </div>
      <div class="form-group form-group-inline">
        <div style="flex:1;">
          <label for="general-sens-input">ì¼ë°˜ ê°ë„</label>
          <input type="number" id="general-sens-input" value="50" min="0" step="0.1">
        </div>
        <div style="flex:1;">
          <label for="vertical-sens-input">ìˆ˜ì§ ê°ë„</label>
          <input type="number" id="vertical-sens-input" value="1" min="0" step="0.1">
        </div>
      </div>
      <div class="form-group form-group-inline">
        <div style="flex:1;">
          <label for="aim-sens-input">ì¡°ì¤€ ê°ë„</label>
          <input type="number" id="aim-sens-input" value="50" min="0" step="0.1">
        </div>
        <div style="flex:1;">
          <label for="scope-sens-input">ìŠ¤ì½”í”„ ëª¨ë“œ ê°ë„</label>
          <input type="number" id="scope-sens-input" value="50" min="0" step="0.1">
        </div>
      </div>

      <h2>ê²Œì„ ì˜ìƒ ì—…ë¡œë“œ</h2>
      <div id="file-drop-zone" class="file-drop">
        <span class="plus-icon">+</span>
        <div id="preview-container"></div>
        <p id="file-list">ìµœëŒ€ 5ê°œ ì˜ìƒ ì—…ë¡œë“œ ê°€ëŠ¥</p>
      </div>
      <input type="file" id="video-input" accept="video/*" multiple hidden>

      <button id="analyze-btn" disabled>ë¶„ì„ ì‹œì‘</button>

      <div class="form-group-inline">
        <label><input type="checkbox" id="unlock-ratio"> ì œí•œ í•´ì œ</label>
        <small id="ratio-status">ê¸°ë³¸ ì„¤ì •: ê°ë„ë¥¼ Â±10% ë‚´ë¡œ ì¡°ì •í•©ë‹ˆë‹¤. ì œí•œ í•´ì œ ì‹œ ì˜ìƒ ë¶„ì„ ê²°ê³¼ì— ë”°ë¼ ìµœëŒ€ Â±20%ê¹Œì§€ ì¡°ì •ë©ë‹ˆë‹¤.</small>
      </div>

      <div id="analysis-result" class="box" style="display:none;"></div>
      <textarea id="copy-fallback" class="copy-fallback" readonly style="display:none;"></textarea>
      <div id="charts" class="chart-container" style="display:none;">
        <canvas id="spray-scatter"></canvas>
        <canvas id="recoil-chart"></canvas>
      </div>

      <aside class="side-note">
        <p>ê°ë„ ë³´ì •ì€ í•œ ë²ˆì˜ ê³„ì‚°ìœ¼ë¡œ ëë‚˜ëŠ” ê²ƒì´ ì•„ë‹™ë‹ˆë‹¤. ë‹¤ì–‘í•œ ìƒí™©ì˜ ì˜ìƒì„ ì—…ë¡œë“œí•˜ê³ , ì‹¤ì œ ë³´ì •ê°’ìœ¼ë¡œ í”Œë ˆì´í•˜ë©° ìì‹ ì˜ ì†ì— ë§ëŠ” ê°ë„ë¥¼ ì°¾ì•„ê°€ëŠ” ë°˜ë³µ ê³¼ì •ì´ ì¤‘ìš”í•©ë‹ˆë‹¤. ì†Œë‚™ì˜ ê°ë„ ë³´ì •ì‚¬ëŠ” ë ˆì´ì € ìƒ·ì„ ì›í•˜ëŠ” ë¶„ë“¤ ì¤‘, ê°ë„ ì„¤ì •ì´ ì˜ëª»ë˜ì—ˆê±°ë‚˜ ë³¸ì¸ì—ê²Œ ë§ì§€ ì•ŠëŠ” ë¶„ë“¤ì—ê²Œ ì˜ìƒ ê¸°ë°˜ì˜ ë¶„ì„ì„ í†µí•´ ë³´ì • ë°©í–¥ì„ ì œì‹œí•´ì£¼ëŠ” ì¡°ë ¥ìì…ë‹ˆë‹¤. <strong>ì œí•œ í•´ì œ</strong>ëŠ” ì˜ìƒ ë¶„ì„ ê²°ê³¼ì— ë”°ë¼ ê°ë„ë¥¼ ìµœëŒ€ Â±20%ê¹Œì§€ ììœ ë¡­ê²Œ ì¡°ì •í•©ë‹ˆë‹¤.</p>
      </aside>

      <div class="link-back">
        <a href="https://sonak-sens-master.vercel.app/">ê°ë„ê³„ì‚°ì´ ê¶ê¸ˆì“°? > ì†Œë‚™ì˜ ê°ë„ì‚¬ë¡œ ã„±ã„±!</a>
      </div>
    </div>
    <div class="explanation-container">
      <h2>ê°ë„ ê³„ì‚° ê³µì‹</h2>
      <p>PUBGì˜ ê°ë„ëŠ” ë§ˆìš°ìŠ¤ ì´ë™ ê±°ë¦¬(D, cm), DPI, ê²Œì„ ë‚´ ê°ë„(S) ê°„ ë¬¼ë¦¬ì  ê´€ê³„ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê³„ì‚°ë©ë‹ˆë‹¤. í™”ë©´ íšŒì „ ê°ë„(Î¸)ëŠ” ë‹¤ìŒ ê³µì‹ìœ¼ë¡œ í‘œí˜„ë©ë‹ˆë‹¤:</p>
      <p style="text-align:center;">Î¸ = (D Ã— DPI Ã— S) / (360 Ã— FOV)</p>
      <p>ì—¬ê¸°ì„œ FOVëŠ” ì‹œì•¼ê°(ê¸°ë³¸ 103ë„)ì…ë‹ˆë‹¤. ì´ ê³µì‹ì€ ë§ˆìš°ìŠ¤ ì´ë™ì´ ê²Œì„ ë‚´ íšŒì „ì„ ì–¼ë§ˆë‚˜ ë¹ ë¥´ê²Œ ë§Œë“œëŠ”ì§€ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.</p>
      <p>ê°ë„ ë³´ì •ì€ ì˜ìƒì—ì„œ ì¶”ì¶œí•œ ë¦¬ì½”ì¼ í¸ì°¨(Î”X: ìˆ˜í‰, Î”Y: ìˆ˜ì§)ë¥¼ ë¶„ì„í•˜ì—¬ ìµœì ì˜ ê°ë„ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤. ë¹„ìœ¨(ratio)ì€ ë‹¤ìŒê³¼ ê°™ì´ ê³„ì‚°ë©ë‹ˆë‹¤:</p>
      <p style="text-align:center;">ratio<sub>X</sub> = 1 - [(mean(|Î”X|) - 5) / 5] Ã— 0.15 Ã— (800 / DPI)</p>
      <p style="text-align:center;">ratio<sub>Y</sub> = 1 - [(mean(|Î”Y|) - 5) / 5] Ã— 0.15 Ã— (800 / DPI)</p>
      <p style="text-align:center;">ratio = (ratio<sub>X</sub> + ratio<sub>Y</sub>) / 2</p>
      <p>mean(|Î”X|), mean(|Î”Y|)ëŠ” ë¦¬ì½”ì¼ í¸ì°¨ì˜ ì ˆëŒ€ê°’ í‰ê· ì´ë©°, ëª©í‘œ í¸ì°¨ëŠ” 5í”½ì…€ì…ë‹ˆë‹¤. DPIê°€ ë†’ì„ìˆ˜ë¡ ì¡°ì • í­ì´ ì¤„ì–´ë“­ë‹ˆë‹¤.</p>

      <h2>ì˜ìƒ ë¶„ì„ ë° ê²°ê³¼ ì¶”ì¶œ</h2>
      <p>ì˜ìƒ ë¶„ì„ì€ ì—…ë¡œë“œëœ ê²Œì„ í”Œë ˆì´ ì˜ìƒì—ì„œ ë§ˆìš°ìŠ¤ ì´ë™ ê¶¤ì ê³¼ ë¦¬ì½”ì¼ íŒ¨í„´ì„ ì¶”ì¶œí•©ë‹ˆë‹¤. í˜„ì¬ëŠ” PUBGì˜ AKM, M416 ê°™ì€ ë¬´ê¸°ì˜ ë¦¬ì½”ì¼ íŒ¨í„´ì„ ëª¨ë°©í•œ ë°ëª¨ ë°ì´í„°(ìˆ˜í‰ í¸ì°¨ Â±7í”½ì…€, ìˆ˜ì§ í¸ì°¨ Â±10í”½ì…€)ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>
      <p><strong>ë¶„ì„ ê³¼ì •:</strong></p>
      <ul>
        <li>1. ì˜ìƒì—ì„œ í”„ë ˆì„ë³„ ë§ˆìš°ìŠ¤ ì´ë™(Î”X, Î”Y)ì„ ì¶”ì .</li>
        <li>2. ë¦¬ì½”ì¼ í¸ì°¨ì˜ ì ˆëŒ€ê°’ í‰ê· (mean(|Î”X|), mean(|Î”Y|)) ê³„ì‚°.</li>
        <li>3. ëª©í‘œ í¸ì°¨(5í”½ì…€)ì™€ ë¹„êµí•´ ë¹„ìœ¨(ratio) ê³„ì‚°.</li>
        <li>4. ê¸°ë³¸ ì„¤ì •(Â±10%) ë˜ëŠ” ì œí•œ í•´ì œ(Â±20%) ì ìš©.</li>
        <li>5. ì…ë ¥ ê°ë„ì— ratioë¥¼ ê³±í•´ ìƒˆë¡œìš´ ê°ë„ ì¶œë ¥.</li>
      </ul>
      <p>ë¯¸ë˜ì—ëŠ” OpenCV.js ë˜ëŠ” ì„œë²„ ì¸¡ ë¶„ì„ì„ í†µí•´ ì‹¤ì œ ì˜ìƒì—ì„œ ë§ˆìš°ìŠ¤ ì´ë™ê³¼ ë¦¬ì½”ì¼ íŒ¨í„´ì„ ì •ë°€ ë¶„ì„í•  ê³„íšì…ë‹ˆë‹¤.</p>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const fileDrop = document.getElementById('file-drop-zone');
    const videoInput = document.getElementById('video-input');
    const fileList = document.getElementById('file-list');
    const previewContainer = document.getElementById('preview-container');
    const analyzeBtn = document.getElementById('analyze-btn');
    const resultDiv = document.getElementById('analysis-result');
    const copyFallback = document.getElementById('copy-fallback');
    const chartsDiv = document.getElementById('charts');
    const generalInput = document.getElementById('general-sens-input');
    const verticalInput = document.getElementById('vertical-sens-input');
    const aimInput = document.getElementById('aim-sens-input');
    const scopeInput = document.getElementById('scope-sens-input');
    const unlockRatio = document.getElementById('unlock-ratio');
    const ratioStatus = document.getElementById('ratio-status');
    const dpiInput = document.getElementById('dpi-input');

    let fileArray = [];
    let cachedResult = null;
    let sprayChart = null;
    let recoilChart = null;

    function updateButton() {
      const inputsValid = generalInput.value && verticalInput.value && aimInput.value && scopeInput.value &&
                         Number(generalInput.value) >= 0 && Number(verticalInput.value) >= 0 &&
                         Number(aimInput.value) >= 0 && Number(scopeInput.value) >= 0;
      analyzeBtn.disabled = !(fileArray.length > 0 && fileArray.length <= 5 && inputsValid);
    }

    function updateFileList() {
      previewContainer.innerHTML = '';
      fileList.textContent = fileArray.length > 0 ? `${fileArray.length}ê°œ íŒŒì¼ ì„ íƒë¨` : 'ìµœëŒ€ 5ê°œ ì˜ìƒ ì—…ë¡œë“œ ê°€ëŠ¥';
      fileArray.forEach((file, index) => {
        const url = URL.createObjectURL(file);
        const thumbContainer = document.createElement('div');
        thumbContainer.className = 'preview-thumb';
        const thumb = document.createElement('video');
        thumb.src = url;
        thumb.muted = true;
        thumb.preload = 'metadata';
        thumb.playsInline = true;
        thumb.controls = false;
        thumb.autoplay = false;
        thumb.loop = false;
        thumb.addEventListener('loadeddata', () => thumb.currentTime = 0.1);
        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'delete-btn';
        deleteBtn.textContent = 'X';
        deleteBtn.onclick = () => {
          fileArray.splice(index, 1);
          const dt = new DataTransfer();
          fileArray.forEach(f => dt.items.add(f));
          videoInput.files = dt.files;
          updateFileList();
          updateButton();
        };
        thumbContainer.appendChild(thumb);
        thumbContainer.appendChild(deleteBtn);
        previewContainer.appendChild(thumbContainer);
      });
      updateButton();
    }

    function handleFiles(files) {
      const newFiles = Array.from(files).filter(file => !fileArray.some(f => f.name === file.name && f.size === f.size));
      fileArray = [...fileArray, ...newFiles].slice(0, 5);
      const dt = new DataTransfer();
      fileArray.forEach(f => dt.items.add(f));
      videoInput.files = dt.files;
      updateFileList();
    }

    videoInput.addEventListener('change', e => handleFiles(e.target.files));
    fileDrop.addEventListener('click', () => videoInput.click());
    fileDrop.addEventListener('dragover', e => { e.preventDefault(); fileDrop.classList.add('dragover'); });
    fileDrop.addEventListener('dragleave', () => fileDrop.classList.remove('dragover'));
    fileDrop.addEventListener('drop', e => { e.preventDefault(); fileDrop.classList.remove('dragover'); handleFiles(e.dataTransfer.files); });

    function resetCache() {
      cachedResult = null;
      if (sprayChart) sprayChart.destroy();
      if (recoilChart) recoilChart.destroy();
      sprayChart = null;
      recoilChart = null;
      resultDiv.style.display = 'none';
      chartsDiv.style.display = 'none';
      copyFallback.style.display = 'none';
    }

    [generalInput, verticalInput, aimInput, scopeInput, dpiInput].forEach(input => {
      input.addEventListener('input', () => {
        resetCache();
        updateButton();
      });
    });

    unlockRatio.addEventListener('change', () => {
      resetCache();
      ratioStatus.textContent = unlockRatio.checked
        ? 'ì œí•œ í•´ì œ: ì˜ìƒ ë¶„ì„ ê²°ê³¼ì— ë”°ë¼ ê°ë„ë¥¼ ìµœëŒ€ Â±20%ê¹Œì§€ ì¡°ì •í•©ë‹ˆë‹¤.'
        : 'ê¸°ë³¸ ì„¤ì •: ê°ë„ë¥¼ Â±10% ë‚´ë¡œ ì¡°ì •í•©ë‹ˆë‹¤.';
      updateButton();
    });

    analyzeBtn.addEventListener('click', () => {
      if (cachedResult) {
        resultDiv.style.display = 'block';
        resultDiv.innerHTML = cachedResult;
        chartsDiv.style.display = 'block';
        copyFallback.style.display = 'none';
        return;
      }

      try {
        const dpi = Number(dpiInput.value) || 800;
        const demoY = Array.from({ length: 20 }, () => (Math.random() - 0.5) * 20);
        const absY = demoY.map(Math.abs);
        const meanY = absY.reduce((a,b)=>a+b)/absY.length || 5;
        const demoX = Array.from({ length: 20 }, () => (Math.random() - 0.5) * 14);
        const absX = demoX.map(Math.abs);
        const meanX = absX.reduce((a,b)=>a+b)/absX.length || 5;

        const ratioX = 1 - ((meanX - 5) / 5) * 0.15 * (800 / dpi);
        const ratioY = 1 - ((meanY - 5) / 5) * 0.15 * (800 / dpi);
        let ratio = (ratioX + ratioY) / 2;
        console.log('MeanX:', meanX, 'MeanY:', meanY, 'RatioX:', ratioX, 'RatioY:', ratioY, 'Raw ratio:', ratio);

        if (!unlockRatio.checked) {
          ratio = Math.max(0.9, Math.min(1.1, ratio));
        } else {
          ratio = Math.max(0.8, Math.min(1.2, ratio));
        }
        console.log('Final ratio:', ratio, 'Unlock checked:', unlockRatio.checked);

        const rec = v => {
          const result = (v * ratio).toFixed(2);
          return isNaN(result) ? '0.00' : result;
        };

        const deltaPercent = ((ratio - 1) * 100).toFixed(1);
        let explanation = '';
        if (meanX > 6 && meanY > 7) {
          explanation = `ì˜ìƒ ë¶„ì„ ê²°ê³¼, ìˆ˜í‰ ë¦¬ì½”ì¼(${meanX.toFixed(1)}í”½ì…€)ê³¼ ìˆ˜ì§ ë¦¬ì½”ì¼(${meanY.toFixed(1)}í”½ì…€)ì´ ëª©í‘œ(5í”½ì…€)ë³´ë‹¤ í½ë‹ˆë‹¤. ë”°ë¼ì„œ ì¼ë°˜/ì¡°ì¤€ ê°ë„ë¥¼ ${Math.abs(deltaPercent)}% ë‚®ì¶”ê³ , ìˆ˜ì§ ê°ë„ë¥¼ ${Math.abs(deltaPercent)}% ë‚®ì¶° ë¦¬ì½”ì¼ ì œì–´ë¥¼ ê°•í™”í–ˆìŠµë‹ˆë‹¤.`;
        } else if (meanX > 6) {
          explanation = `ì˜ìƒ ë¶„ì„ ê²°ê³¼, ìˆ˜í‰ ë¦¬ì½”ì¼(${meanX.toFixed(1)}í”½ì…€)ì´ ëª©í‘œ(5í”½ì…€)ë³´ë‹¤ í½ë‹ˆë‹¤. ë”°ë¼ì„œ ì¼ë°˜/ì¡°ì¤€ ê°ë„ë¥¼ ${Math.abs(deltaPercent)}% ë‚®ì·„ìŠµë‹ˆë‹¤. ìˆ˜ì§ ë¦¬ì½”ì¼(${meanY.toFixed(1)}í”½ì…€)ì€ ì ì ˆí•´ ìˆ˜ì§ ê°ë„ëŠ” ë¯¸ì„¸ ì¡°ì •í–ˆìŠµë‹ˆë‹¤.`;
        } else if (meanY > 7) {
          explanation = `ì˜ìƒ ë¶„ì„ ê²°ê³¼, ìˆ˜ì§ ë¦¬ì½”ì¼(${meanY.toFixed(1)}í”½ì…€)ì´ ëª©í‘œ(5í”½ì…€)ë³´ë‹¤ í½ë‹ˆë‹¤. ë”°ë¼ì„œ ìˆ˜ì§ ê°ë„ë¥¼ ${Math.abs(deltaPercent)}% ë‚®ì·„ìŠµë‹ˆë‹¤. ìˆ˜í‰ ë¦¬ì½”ì¼(${meanX.toFixed(1)}í”½ì…€)ì€ ì ì ˆí•´ ì¼ë°˜/ì¡°ì¤€ ê°ë„ëŠ” ë¯¸ì„¸ ì¡°ì •í–ˆìŠµë‹ˆë‹¤.`;
        } else {
          explanation = `ì˜ìƒ ë¶„ì„ ê²°ê³¼, ìˆ˜í‰ ë¦¬ì½”ì¼(${meanX.toFixed(1)}í”½ì…€)ê³¼ ìˆ˜ì§ ë¦¬ì½”ì¼(${meanY.toFixed(1)}í”½ì…€)ì´ ëª©í‘œ(5í”½ì…€)ì— ê°€ê¹ìŠµë‹ˆë‹¤. ì •ë°€ë„ë¥¼ ë†’ì´ê¸° ìœ„í•´ ëª¨ë“  ê°ë„ë¥¼ ${Math.abs(deltaPercent)}% ${deltaPercent > 0 ? 'ë†’ì˜€ìŠµë‹ˆë‹¤' : 'ë‚®ì·„ìŠµë‹ˆë‹¤'}.`;
        }

        const resultHTML = `
          <strong>ì¶”ì²œ ê°ë„</strong><br>
          - ì¼ë°˜: ${rec(+generalInput.value)}<br>
          - ìˆ˜ì§: ${rec(+verticalInput.value)}<br>
          - ì¡°ì¤€: ${rec(+aimInput.value)}<br>
          - ìŠ¤ì½”í”„: ${rec(+scopeInput.value)}<br>
          <div class="result-explanation">${explanation}</div>
          <div class="copy-btn" onclick="copyResults()">ê²°ê³¼ ë³µì‚¬</div>
        `;
        cachedResult = resultHTML;
        resultDiv.style.display = 'block';
        resultDiv.innerHTML = resultHTML;
        copyFallback.value = `ì¼ë°˜: ${rec(+generalInput.value)}\nìˆ˜ì§: ${rec(+verticalInput.value)}\nì¡°ì¤€: ${rec(+aimInput.value)}\nìŠ¤ì½”í”„: ${rec(+scopeInput.value)}`;
        chartsDiv.style.display = 'block';
        copyFallback.style.display = 'none';

        if (sprayChart) sprayChart.destroy();
        if (recoilChart) recoilChart.destroy();

        sprayChart = new Chart('spray-scatter', {
          type: 'scatter',
          data: {
            datasets: [{
              label: 'ìŠ¤í”„ë ˆì´',
              data: Array.from({length: 50}, () => ({
                x: (Math.random() - 0.5) * 14,
                y: (Math.random() - 0.5) * 20
              })),
              backgroundColor: 'rgba(0, 163, 224, 0.6)'
            }]
          },
          options: {
            plugins: { title: { display: true, text: 'ìŠ¤í”„ë ˆì´ íŒ¨í„´' } },
            scales: {
              x: { title: { display: true, text: 'ìˆ˜í‰ í¸ì°¨ (í”½ì…€)' } },
              y: { title: { display: true, text: 'ìˆ˜ì§ í¸ì°¨ (í”½ì…€)' } }
            }
          }
        });

        recoilChart = new Chart('recoil-chart', {
          type: 'line',
          data: {
            labels: Array.from({length: 20}, (_, i) => i + 1),
            datasets: [
              { label: '|Î”Y|', data: absY, borderColor: '#00A3E0', fill: false },
              { label: '|Î”X|', data: absX, borderColor: '#005F9E', fill: false }
            ]
          },
          options: {
            plugins: { title: { display: true, text: 'ë¦¬ì½”ì¼ ë¶„ì„' } },
            scales: {
              x: { title: { display: true, text: 'í”„ë ˆì„' } },
              y: { title: { display: true, text: 'í¸ì°¨ í¬ê¸° (í”½ì…€)' } }
            }
          }
        });
      } catch (err) {
        console.error('ë¶„ì„ ì˜¤ë¥˜:', err);
        alert('ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì…ë ¥ ê°’ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
      }
    });

    function copyResults() {
      const text = `ì¼ë°˜: ${resultDiv.querySelectorAll('br')[1].previousSibling.textContent.split(': ')[1]}\n` +
                   `ìˆ˜ì§: ${resultDiv.querySelectorAll('br')[2].previousSibling.textContent.split(': ')[1]}\n` +
                   `ì¡°ì¤€: ${resultDiv.querySelectorAll('br')[3].previousSibling.textContent.split(': ')[1]}\n` +
                   `ìŠ¤ì½”í”„: ${resultDiv.querySelectorAll('br')[4].previousSibling.textContent.split(': ')[1]}`;
      
      if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(text).then(() => {
          alert('ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
          copyFallback.style.display = 'none';
        }).catch(err => {
          console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨:', err);
          fallbackCopy(text);
        });
      } else {
        fallbackCopy(text);
      }
    }

    function fallbackCopy(text) {
      copyFallback.style.display = 'block';
      copyFallback.value = text;
      copyFallback.focus();
      copyFallback.select();
      try {
        document.execCommand('copy');
        alert('ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
        copyFallback.style.display = 'none';
      } catch (err) {
        console.error('ëŒ€ì²´ ë³µì‚¬ ì‹¤íŒ¨:', err);
        alert('í´ë¦½ë³´ë“œ ë³µì‚¬ê°€ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì•„ë˜ í…ìŠ¤íŠ¸ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ë³µì‚¬í•´ì£¼ì„¸ìš”.');
      }
    }
  </script>
</body>
</html>
