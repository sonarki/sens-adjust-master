<!DOCTYPE html>
<html lang="ko">
<head>
  <meta name="robots" content="index, follow">
  <meta name="description" content="ÏÜåÎÇôÏùò Í∞êÎèÑ Î≥¥Ï†ïÏÇ¨ üéØ Î∞∞ÌãÄÍ∑∏ÎùºÏö¥Îìú Í∞êÎèÑ Î∂ÑÏÑù ÎèÑÍµ¨. ÎßâÏ∞ΩÏÉ∑ÏóêÏÑú Î†àÏù¥Ï†ÄÍπåÏßÄ, Í∞êÎèÑ Î¨∏Ï†úÎ•º Ìï¥Í≤∞ÌïòÏÑ∏Ïöî!">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ÏÜåÎÇôÏùò Í∞êÎèÑ Ï°∞Ï†ïÏÇ¨</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-color: #005F9E;
      --accent-color: #00A3E0;
      --bg-color: #F5F7FA;
      --card-bg: #FFFFFF;
      --text-color: #1A202C;
      --subtext-color: #6B7280;
      --border-radius: 12px;
      --spacing: 1.5rem;
      --shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg-color);
      color: var(--text-color);
      line-height: 1.6;
    }
    .site-header {
      background: linear-gradient(135deg, var(--primary-color) 0%, #003F6B 100%);
      height: 5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow);
      padding: 0 1rem;
    }
    .main-container {
      max-width: 1200px;
      margin: var(--spacing) auto;
      display: flex;
      gap: 2rem;
      padding: 0 var(--spacing);
    }
    .input-container {
      flex: 1;
      max-width: 600px;
      background: var(--card-bg);
      border-radius: var(--border-radius);
      padding: var(--spacing);
      box-shadow: var(--shadow);
    }
    .explanation-container {
      flex: 1;
      max-width: 500px;
      background: #E6F0FA;
      border-radius: var(--border-radius);
      padding: var(--spacing);
      box-shadow: var(--shadow);
    }
    h1 { display: none; }
    h2 {
      font-size: 1.5rem;
      margin-top: 2rem;
      margin-bottom: var(--spacing);
      color: var(--text-color);
      font-weight: 600;
    }
    .explanation-container h2 {
      font-size: 1.3rem;
    }
    .form-group { margin-bottom: var(--spacing); }
    label {
      display: block;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--text-color);
    }
    input[type=number], select {
      width: 100%;
      padding: 0.875rem;
      border: 1px solid #D1D5DB;
      border-radius: var(--border-radius);
      background: #F9FAFB;
      font-size: 1rem;
      color: var(--text-color);
      transition: border-color 0.3s, box-shadow 0.3s;
    }
    input[type=number]:focus, select:focus {
      outline: none;
      border-color: var(--accent-color);
      box-shadow: 0 0 0 3px rgba(0, 163, 224, 0.2);
    }
    .file-drop {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      padding: 2.5rem;
      border: 2px dashed #D1D5DB;
      border-radius: var(--border-radius);
      background: #F9FAFB;
      cursor: pointer;
      transition: border-color 0.3s, background 0.3s;
    }
    .file-drop.dragover {
      border-color: var(--accent-color);
      background: rgba(0, 163, 224, 0.1);
    }
    .plus-icon {
      font-size: 1.5rem;
      color: var(--subtext-color);
      margin-bottom: 0.75rem;
    }
    #file-list {
      margin-top: 0.75rem;
      color: var(--subtext-color);
      font-size: 0.95rem;
    }
    #preview-container {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      margin-top: 1.5rem;
    }
    .preview-thumb {
      position: relative;
      flex: 0 0 100px;
      height: 56px;
      border-radius: var(--border-radius);
      overflow: hidden;
      background: #000;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    .preview-thumb video {
      width: 100%;
      height: 100%;
      object-fit: cover;
      opacity: 0.9;
    }
    .delete-btn {
      position: absolute;
      top: 4px;
      right: 4px;
      background: #EF4444;
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background 0.2s;
    }
    .delete-btn:hover {
      background: #B91C1C;
    }
    button {
      width: 100%;
      padding: 1rem;
      margin-top: var(--spacing);
      font-size: 1.1rem;
      font-weight: 600;
      color: #fff;
      background: var(--accent-color);
      border: none;
      border-radius: var(--border-radius);
      cursor: pointer;
      transition: background 0.3s, transform 0.2s, box-shadow 0.3s;
    }
    button:disabled {
      background: #D1D5DB;
      cursor: not-allowed;
    }
    button:not(:disabled):hover {
      background: #0086B3;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 163, 224, 0.3);
    }
    .form-group-inline {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    .form-group-inline small {
      max-width: 400px;
      color: var(--subtext-color);
      font-size: 0.9rem;
      line-height: 1.4;
    }
    .box {
      background: #F9FAFB;
      padding: var(--spacing);
      border-radius: var(--border-radius);
      border: 2px solid var(--accent-color);
      margin-top: var(--spacing);
      box-shadow: var(--shadow);
      transition: background 0.2s;
    }
    .box:hover {
      background: #E6F0FA;
    }
    #analysis-result {
      font-size: 1rem;
      color: var(--text-color);
    }
    .result-explanation {
      margin-top: 1rem;
      font-size: 0.95rem;
      color: var(--subtext-color);
      border-top: 1px solid #D1D5DB;
      padding-top: 1rem;
    }
    .copy-btn {
      display: inline-block;
      margin-top: 1rem;
      padding: 0.5rem 1rem;
      background: var(--primary-color);
      color: #fff;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 600;
      transition: background 0.2s;
    }
    .copy-btn:hover {
      background: #003F6B;
    }
    .copy-fallback {
      margin-top: 1rem;
      display: none;
      width: 100%;
      padding: 0.5rem;
      font-size: 0.9rem;
      background: #F9FAFB;
      border: 1px solid #D1D5DB;
      border-radius: var(--border-radius);
    }
    .link-back {
      display: flex;
      justify-content: flex-end;
      margin-top: var(--spacing);
    }
    .link-back a {
      color: var(--accent-color);
      text-decoration: none;
      font-weight: 600;
      transition: color 0.2s;
    }
    .link-back a:hover {
      color: #0086B3;
    }
    .chart-container {
      margin-top: var(--spacing);
    }
    canvas {
      border-radius: var(--border-radius);
      background: #fff;
      box-shadow: var(--shadow);
    }
    .main-heading {
      font-size: 1.8rem;
      font-weight: 700;
      color: #fff;
      text-align: center;
      display: flex;
      align-items: center;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: 100%;
    }
    .sub-heading {
      font-size: 0.95rem;
      font-weight: 400;
      color: #E6F0FA;
      text-align: center;
      margin-top: 0.25rem;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: normal;
      max-width: 100%;
    }
    .target-icon {
      background: var(--accent-color);
      border-radius: 6px;
      padding: 0.2rem 0.4rem;
      margin-left: 0.5rem;
      font-size: 1.5rem;
      display: inline-block;
      line-height: 1;
    }
    .side-note {
      max-width: 600px;
      margin: 2rem auto;
      padding: 1.75rem;
      background: #E6F0FA;
      border: 2px solid var(--accent-color);
      border-radius: var(--border-radius);
      font-size: 0.95rem;
      color: var(--text-color);
      box-shadow: var(--shadow);
    }
    @media (max-width: 900px) {
      .main-container {
        flex-direction: column;
      }
      .input-container, .explanation-container {
        max-width: 100%;
      }
    }
    @media (max-width: 600px) {
      .site-header {
        height: 6rem;
      }
      .main-heading {
        font-size: 1.5rem;
      }
      .sub-heading {
        font-size: 0.85rem;
        margin-top: 0.5rem;
      }
      .target-icon {
        font-size: 1.2rem;
        padding: 0.15rem 0.3rem;
      }
      .form-group-inline {
        flex-direction: column;
        align-items: flex-start;
      }
      .form-group-inline small {
        max-width: 100%;
      }
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div style="display: flex; flex-direction: column; align-items: center;">
      <div class="main-heading">ÏÜåÎÇôÏùò Í∞êÎèÑ Î≥¥Ï†ïÏÇ¨ <span class="target-icon">üéØ</span></div>
      <div class="sub-heading">ÎßâÏ∞ΩÏÉ∑Îì§ ÎìúÎ£®ÏôÄ, Î†àÏù¥Ï†ÄÎ°ú Í∞ÄÏ¶àÏïÑ!</div>
    </div>
  </header>
  <div class="main-container">
    <div class="input-container">
      <h1>ÏÜåÎÇôÏùò Í∞êÎèÑ Ï°∞Ï†ïÏÇ¨</h1>
      <h2>ÏÇ¨Ïö©Ïûê Í∞êÎèÑ ÏÑ§Ï†ï</h2>
      <div class="form-group">
        <label for="dpi-input">ÌòÑÏû¨ DPI</label>
        <select id="dpi-input">
          <option>400</option><option>800</option><option>1200</option><option>1800</option><option>3200</option>
        </select>
      </div>
      <div class="form-group form-group-inline">
        <div style="flex:1;">
          <label for="general-sens-input">ÏùºÎ∞ò Í∞êÎèÑ</label>
          <input type="number" id="general-sens-input" value="50" min="0" step="0.1">
        </div>
        <div style="flex:1;">
          <label for="vertical-sens-input">ÏàòÏßÅ Í∞êÎèÑ</label>
          <input type="number" id="vertical-sens-input" value="1" min="0" step="0.1">
        </div>
      </div>
      <div class="form-group form-group-inline">
        <div style="flex:1;">
          <label for="aim-sens-input">Ï°∞Ï§Ä Í∞êÎèÑ</label>
          <input type="number" id="aim-sens-input" value="50" min="0" step="0.1">
        </div>
        <div style="flex:1;">
          <label for="scope-sens-input">Ïä§ÏΩîÌîÑ Î™®Îìú Í∞êÎèÑ</label>
          <input type="number" id="scope-sens-input" value="50" min="0" step="0.1">
        </div>
      </div>

      <h2>Í≤åÏûÑ ÏòÅÏÉÅ ÏóÖÎ°úÎìú</h2>
      <div id="file-drop-zone" class="file-drop">
        <span class="plus-icon">+</span>
        <div id="preview-container"></div>
        <p id="file-list">ÏµúÎåÄ 5Í∞ú ÏòÅÏÉÅ ÏóÖÎ°úÎìú Í∞ÄÎä•</p>
      </div>
      <input type="file" id="video-input" accept="video/*" multiple hidden>

      <button id="analyze-btn" disabled>Î∂ÑÏÑù ÏãúÏûë</button>

      <div class="form-group-inline">
        <label><input type="checkbox" id="unlock-ratio"> Ï†úÌïú Ìï¥Ï†ú</label>
        <small id="ratio-status">Í∏∞Î≥∏ ÏÑ§Ï†ï: Í∞êÎèÑÎ•º ¬±10% ÎÇ¥Î°ú Ï°∞Ï†ïÌï©ÎãàÎã§. Ï†úÌïú Ìï¥Ï†ú Ïãú ÏòÅÏÉÅ Î∂ÑÏÑù Í≤∞Í≥ºÏóê Îî∞Îùº ÏµúÎåÄ ¬±20%ÍπåÏßÄ Ï°∞Ï†ïÎê©ÎãàÎã§.</small>
      </div>

      <div id="analysis-result" class="box" style="display:none;"></div>
      <textarea id="copy-fallback" class="copy-fallback" readonly style="display:none;"></textarea>
      <div id="charts" class="chart-container" style="display:none;">
        <canvas id="spray-scatter"></canvas>
        <canvas id="recoil-chart"></canvas>
      </div>

      <aside class="side-note">
        <p>Í∞êÎèÑ Î≥¥Ï†ïÏùÄ Ìïú Î≤àÏùò Í≥ÑÏÇ∞ÏúºÎ°ú ÎÅùÎÇòÎäî Í≤ÉÏù¥ ÏïÑÎãôÎãàÎã§. Îã§ÏñëÌïú ÏÉÅÌô©Ïùò ÏòÅÏÉÅÏùÑ ÏóÖÎ°úÎìúÌïòÍ≥†, Ïã§Ï†ú Î≥¥Ï†ïÍ∞íÏúºÎ°ú ÌîåÎ†àÏù¥ÌïòÎ©∞ ÏûêÏã†Ïùò ÏÜêÏóê ÎßûÎäî Í∞êÎèÑÎ•º Ï∞æÏïÑÍ∞ÄÎäî Î∞òÎ≥µ Í≥ºÏ†ïÏù¥ Ï§ëÏöîÌï©ÎãàÎã§. ÏÜåÎÇôÏùò Í∞êÎèÑ Î≥¥Ï†ïÏÇ¨Îäî Î†àÏù¥Ï†Ä ÏÉ∑ÏùÑ ÏõêÌïòÎäî Î∂ÑÎì§ Ï§ë, Í∞êÎèÑ ÏÑ§Ï†ïÏù¥ ÏûòÎ™ªÎêòÏóàÍ±∞ÎÇò Î≥∏Ïù∏ÏóêÍ≤å ÎßûÏßÄ ÏïäÎäî Î∂ÑÎì§ÏóêÍ≤å ÏòÅÏÉÅ Í∏∞Î∞òÏùò Î∂ÑÏÑùÏùÑ ÌÜµÌï¥ Î≥¥Ï†ï Î∞©Ìñ•ÏùÑ Ï†úÏãúÌï¥Ï£ºÎäî Ï°∞Î†•ÏûêÏûÖÎãàÎã§. <strong>Ï†úÌïú Ìï¥Ï†ú</strong>Îäî ÏòÅÏÉÅ Î∂ÑÏÑù Í≤∞Í≥ºÏóê Îî∞Îùº Í∞êÎèÑÎ•º ÏµúÎåÄ ¬±20%ÍπåÏßÄ ÏûêÏú†Î°≠Í≤å Ï°∞Ï†ïÌï©ÎãàÎã§.</p>
      </aside>

      <div class="link-back">
        <a href="https://sonak-sens-master.vercel.app/">Í∞êÎèÑÍ≥ÑÏÇ∞Ïù¥ Í∂ÅÍ∏àÏì∞? > ÏÜåÎÇôÏùò Í∞êÎèÑÏÇ¨Î°ú „Ñ±„Ñ±!</a>
      </div>
    </div>
    <div class="explanation-container">
      <h2>Í∞êÎèÑ Í≥ÑÏÇ∞ Í≥µÏãù</h2>
      <p>PUBGÏùò Í∞êÎèÑÎäî ÎßàÏö∞Ïä§ Ïù¥Îèô Í±∞Î¶¨(D, cm), DPI, Í≤åÏûÑ ÎÇ¥ Í∞êÎèÑ(S) Í∞Ñ Î¨ºÎ¶¨Ï†Å Í¥ÄÍ≥ÑÎ•º Í∏∞Î∞òÏúºÎ°ú Í≥ÑÏÇ∞Îê©ÎãàÎã§. ÌôîÎ©¥ ÌöåÏ†Ñ Í∞ÅÎèÑ(Œ∏)Îäî Îã§Ïùå Í≥µÏãùÏúºÎ°ú ÌëúÌòÑÎê©ÎãàÎã§:</p>
      <p style="text-align:center;">Œ∏ = (D √ó DPI √ó S) / (360 √ó FOV)</p>
      <p>Ïó¨Í∏∞ÏÑú FOVÎäî ÏãúÏïºÍ∞Å(Í∏∞Î≥∏ 103ÎèÑ)ÏûÖÎãàÎã§. Ïù¥ Í≥µÏãùÏùÄ ÎßàÏö∞Ïä§ Ïù¥ÎèôÏù¥ Í≤åÏûÑ ÎÇ¥ ÌöåÏ†ÑÏùÑ ÏñºÎßàÎÇò Îπ†Î•¥Í≤å ÎßåÎìúÎäîÏßÄÎ•º ÎÇòÌÉÄÎÉÖÎãàÎã§.</p>
      <p>Í∞êÎèÑ Î≥¥Ï†ïÏùÄ ÏòÅÏÉÅÏóêÏÑú Ï∂îÏ∂úÌïú Î¶¨ÏΩîÏùº Ìé∏Ï∞®(ŒîX: ÏàòÌèâ, ŒîY: ÏàòÏßÅ)Î•º Î∂ÑÏÑùÌïòÏó¨ ÏµúÏ†ÅÏùò Í∞êÎèÑÎ•º Í≥ÑÏÇ∞Ìï©ÎãàÎã§. ÎπÑÏú®(ratio)ÏùÄ Îã§ÏùåÍ≥º Í∞ôÏù¥ Í≥ÑÏÇ∞Îê©ÎãàÎã§:</p>
      <p style="text-align:center;">ratio<sub>X</sub> = 1 - [(mean(|ŒîX|) - 5) / 5] √ó 0.15 √ó (800 / DPI)</p>
      <p style="text-align:center;">ratio<sub>Y</sub> = 1 - [(mean(|ŒîY|) - 5) / 5] √ó 0.15 √ó (800 / DPI)</p>
      <p style="text-align:center;">ratio = (ratio<sub>X</sub> + ratio<sub>Y</sub>) / 2</p>
      <p>mean(|ŒîX|), mean(|ŒîY|)Îäî Î¶¨ÏΩîÏùº Ìé∏Ï∞®Ïùò Ï†àÎåÄÍ∞í ÌèâÍ∑†Ïù¥Î©∞, Î™©Ìëú Ìé∏Ï∞®Îäî 5ÌîΩÏÖÄÏûÖÎãàÎã§. DPIÍ∞Ä ÎÜíÏùÑÏàòÎ°ù Ï°∞Ï†ï Ìè≠Ïù¥ Ï§ÑÏñ¥Îì≠ÎãàÎã§.</p>

      <h2>ÏòÅÏÉÅ Î∂ÑÏÑù Î∞è Í≤∞Í≥º Ï∂îÏ∂ú</h2>
      <p>ÏòÅÏÉÅ Î∂ÑÏÑùÏùÄ ÏóÖÎ°úÎìúÎêú Í≤åÏûÑ ÌîåÎ†àÏù¥ ÏòÅÏÉÅÏóêÏÑú ÎßàÏö∞Ïä§ Ïù¥Îèô Í∂§Ï†ÅÍ≥º Î¶¨ÏΩîÏùº Ìå®ÌÑ¥ÏùÑ Ï∂îÏ∂úÌï©ÎãàÎã§. ÌòÑÏû¨Îäî PUBGÏùò AKM, M416 Í∞ôÏùÄ Î¨¥Í∏∞Ïùò Î¶¨ÏΩîÏùº Ìå®ÌÑ¥ÏùÑ Î™®Î∞©Ìïú Îç∞Î™® Îç∞Ïù¥ÌÑ∞(ÏàòÌèâ Ìé∏Ï∞® ¬±7ÌîΩÏÖÄ, ÏàòÏßÅ Ìé∏Ï∞® ¬±10ÌîΩÏÖÄ)Î•º ÏÇ¨Ïö©Ìï©ÎãàÎã§.</p>
      <p><strong>Î∂ÑÏÑù Í≥ºÏ†ï:</strong></p>
      <ul>
        <li>1. ÏòÅÏÉÅÏóêÏÑú ÌîÑÎ†àÏûÑÎ≥Ñ ÎßàÏö∞Ïä§ Ïù¥Îèô(ŒîX, ŒîY)ÏùÑ Ï∂îÏ†Å.</li>
        <li>2. Î¶¨ÏΩîÏùº Ìé∏Ï∞®Ïùò Ï†àÎåÄÍ∞í ÌèâÍ∑†(mean(|ŒîX|), mean(|ŒîY|)) Í≥ÑÏÇ∞.</li>
        <li>3. Î™©Ìëú Ìé∏Ï∞®(5ÌîΩÏÖÄ)ÏôÄ ÎπÑÍµêÌï¥ ÎπÑÏú®(ratio) Í≥ÑÏÇ∞.</li>
        <li>4. Í∏∞Î≥∏ ÏÑ§Ï†ï(¬±10%) ÎòêÎäî Ï†úÌïú Ìï¥Ï†ú(¬±20%) Ï†ÅÏö©.</li>
        <li>5. ÏûÖÎ†• Í∞êÎèÑÏóê ratioÎ•º Í≥±Ìï¥ ÏÉàÎ°úÏö¥ Í∞êÎèÑ Ï∂úÎ†•.</li>
      </ul>
      <p>ÎØ∏ÎûòÏóêÎäî OpenCV.js ÎòêÎäî ÏÑúÎ≤Ñ Ï∏° Î∂ÑÏÑùÏùÑ ÌÜµÌï¥ Ïã§Ï†ú ÏòÅÏÉÅÏóêÏÑú ÎßàÏö∞Ïä§ Ïù¥ÎèôÍ≥º Î¶¨ÏΩîÏùº Ìå®ÌÑ¥ÏùÑ Ï†ïÎ∞Ä Î∂ÑÏÑùÌï† Í≥ÑÌöçÏûÖÎãàÎã§.</p>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const fileDrop = document.getElementById('file-drop-zone');
    const videoInput = document.getElementById('video-input');
    const fileList = document.getElementById('file-list');
    const previewContainer = document.getElementById('preview-container');
    const analyzeBtn = document.getElementById('analyze-btn');
    const resultDiv = document.getElementById('analysis-result');
    const copyFallback = document.getElementById('copy-fallback');
    const chartsDiv = document.getElementById('charts');
    const generalInput = document.getElementById('general-sens-input');
    const verticalInput = document.getElementById('vertical-sens-input');
    const aimInput = document.getElementById('aim-sens-input');
    const scopeInput = document.getElementById('scope-sens-input');
    const unlockRatio = document.getElementById('unlock-ratio');
    const ratioStatus = document.getElementById('ratio-status');
    const dpiInput = document.getElementById('dpi-input');

    let fileArray = [];
    let cachedResult = null;
    let sprayChart = null;
    let recoilChart = null;

    function updateButton() {
      const inputsValid = generalInput.value && verticalInput.value && aimInput.value && scopeInput.value &&
                         Number(generalInput.value) >= 0 && Number(verticalInput.value) >= 0 &&
                         Number(aimInput.value) >= 0 && Number(scopeInput.value) >= 0;
      analyzeBtn.disabled = !(fileArray.length > 0 && fileArray.length <= 5 && inputsValid);
    }

    function updateFileList() {
      previewContainer.innerHTML = '';
      fileList.textContent = fileArray.length > 0 ? `${fileArray.length}Í∞ú ÌååÏùº ÏÑ†ÌÉùÎê®` : 'ÏµúÎåÄ 5Í∞ú ÏòÅÏÉÅ ÏóÖÎ°úÎìú Í∞ÄÎä•';
      fileArray.forEach((file, index) => {
        const url = URL.createObjectURL(file);
        const thumbContainer = document.createElement('div');
        thumbContainer.className = 'preview-thumb';
        const thumb = document.createElement('video');
        thumb.src = url;
        thumb.muted = true;
        thumb.preload = 'metadata';
        thumb.playsInline = true;
        thumb.controls = false;
        thumb.autoplay = false;
        thumb.loop = false;
        thumb.addEventListener('loadeddata', () => thumb.currentTime = 0.1);
        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'delete-btn';
        deleteBtn.textContent = 'X';
        deleteBtn.onclick = () => {
          fileArray.splice(index, 1);
          const dt = new DataTransfer();
          fileArray.forEach(f => dt.items.add(f));
          videoInput.files = dt.files;
          updateFileList();
          updateButton();
        };
        thumbContainer.appendChild(thumb);
        thumbContainer.appendChild(deleteBtn);
        previewContainer.appendChild(thumbContainer);
      });
      updateButton();
    }

    function handleFiles(files) {
      const newFiles = Array.from(files).filter(file => !fileArray.some(f => f.name === file.name && f.size === f.size));
      fileArray = [...fileArray, ...newFiles].slice(0, 5);
      const dt = new DataTransfer();
      fileArray.forEach(f => dt.items.add(f));
      videoInput.files = dt.files;
      updateFileList();
    }

    videoInput.addEventListener('change', e => handleFiles(e.target.files));
    fileDrop.addEventListener('click', () => videoInput.click());
    fileDrop.addEventListener('dragover', e => { e.preventDefault(); fileDrop.classList.add('dragover'); });
    fileDrop.addEventListener('dragleave', () => fileDrop.classList.remove('dragover'));
    fileDrop.addEventListener('drop', e => { e.preventDefault(); fileDrop.classList.remove('dragover'); handleFiles(e.dataTransfer.files); });

    function resetCache() {
      cachedResult = null;
      if (sprayChart) sprayChart.destroy();
      if (recoilChart) recoilChart.destroy();
      sprayChart = null;
      recoilChart = null;
      resultDiv.style.display = 'none';
      chartsDiv.style.display = 'none';
      copyFallback.style.display = 'none';
    }

    [generalInput, verticalInput, aimInput, scopeInput, dpiInput].forEach(input => {
      input.addEventListener('input', () => {
        resetCache();
        updateButton();
      });
    });

    unlockRatio.addEventListener('change', () => {
      resetCache();
      ratioStatus.textContent = unlockRatio.checked
        ? 'Ï†úÌïú Ìï¥Ï†ú: ÏòÅÏÉÅ Î∂ÑÏÑù Í≤∞Í≥ºÏóê Îî∞Îùº Í∞êÎèÑÎ•º ÏµúÎåÄ ¬±20%ÍπåÏßÄ Ï°∞Ï†ïÌï©ÎãàÎã§.'
        : 'Í∏∞Î≥∏ ÏÑ§Ï†ï: Í∞êÎèÑÎ•º ¬±10% ÎÇ¥Î°ú Ï°∞Ï†ïÌï©ÎãàÎã§.';
      updateButton();
    });

    analyzeBtn.addEventListener('click', () => {
      if (cachedResult) {
        resultDiv.style.display = 'block';
        resultDiv.innerHTML = cachedResult;
        chartsDiv.style.display = 'block';
        copyFallback.style.display = 'none';
        return;
      }

      try {
        const dpi = Number(dpiInput.value) || 800;
        const demoY = Array.from({ length: 20 }, () => (Math.random() - 0.5) * 20);
        const absY = demoY.map(Math.abs);
        const meanY = absY.reduce((a,b)=>a+b)/absY.length || 5;
        const demoX = Array.from({ length: 20 }, () => (Math.random() - 0.5) * 14);
        const absX = demoX.map(Math.abs);
        const meanX = absX.reduce((a,b)=>a+b)/absX.length || 5;

        const ratioX = 1 - ((meanX - 5) / 5) * 0.15 * (800 / dpi);
        const ratioY = 1 - ((meanY - 5) / 5) * 0.15 * (800 / dpi);
        let ratio = (ratioX + ratioY) / 2;
        console.log('MeanX:', meanX, 'MeanY:', meanY, 'RatioX:', ratioX, 'RatioY:', ratioY, 'Raw ratio:', ratio);

        if (!unlockRatio.checked) {
          ratio = Math.max(0.9, Math.min(1.1, ratio));
        } else {
          ratio = Math.max(0.8, Math.min(1.2, ratio));
        }
        console.log('Final ratio:', ratio, 'Unlock checked:', unlockRatio.checked);

        const rec = v => {
          const result = (v * ratio).toFixed(2);
          return isNaN(result) ? '0.00' : result;
        };

        const deltaPercent = ((ratio - 1) * 100).toFixed(1);
        let explanation = '';
        if (meanX > 6 && meanY > 7) {
          explanation = `ÏòÅÏÉÅ Î∂ÑÏÑù Í≤∞Í≥º, ÏàòÌèâ Î¶¨ÏΩîÏùº(${meanX.toFixed(1)}ÌîΩÏÖÄ)Í≥º ÏàòÏßÅ Î¶¨ÏΩîÏùº(${meanY.toFixed(1)}ÌîΩÏÖÄ)Ïù¥ Î™©Ìëú(5ÌîΩÏÖÄ)Î≥¥Îã§ ÌÅΩÎãàÎã§. Îî∞ÎùºÏÑú ÏùºÎ∞ò/Ï°∞Ï§Ä Í∞êÎèÑÎ•º ${Math.abs(deltaPercent)}% ÎÇÆÏ∂îÍ≥†, ÏàòÏßÅ Í∞êÎèÑÎ•º ${Math.abs(deltaPercent)}% ÎÇÆÏ∂∞ Î¶¨ÏΩîÏùº Ï†úÏñ¥Î•º Í∞ïÌôîÌñàÏäµÎãàÎã§.`;
        } else if (meanX > 6) {
          explanation = `ÏòÅÏÉÅ Î∂ÑÏÑù Í≤∞Í≥º, ÏàòÌèâ Î¶¨ÏΩîÏùº(${meanX.toFixed(1)}ÌîΩÏÖÄ)Ïù¥ Î™©Ìëú(5ÌîΩÏÖÄ)Î≥¥Îã§ ÌÅΩÎãàÎã§. Îî∞ÎùºÏÑú ÏùºÎ∞ò/Ï°∞Ï§Ä Í∞êÎèÑÎ•º ${Math.abs(deltaPercent)}% ÎÇÆÏ∑ÑÏäµÎãàÎã§. ÏàòÏßÅ Î¶¨ÏΩîÏùº(${meanY.toFixed(1)}ÌîΩÏÖÄ)ÏùÄ Ï†ÅÏ†àÌï¥ ÏàòÏßÅ Í∞êÎèÑÎäî ÎØ∏ÏÑ∏ Ï°∞Ï†ïÌñàÏäµÎãàÎã§.`;
        } else if (meanY > 7) {
          explanation = `ÏòÅÏÉÅ Î∂ÑÏÑù Í≤∞Í≥º, ÏàòÏßÅ Î¶¨ÏΩîÏùº(${meanY.toFixed(1)}ÌîΩÏÖÄ)Ïù¥ Î™©Ìëú(5ÌîΩÏÖÄ)Î≥¥Îã§ ÌÅΩÎãàÎã§. Îî∞ÎùºÏÑú ÏàòÏßÅ Í∞êÎèÑÎ•º ${Math.abs(deltaPercent)}% ÎÇÆÏ∑ÑÏäµÎãàÎã§. ÏàòÌèâ Î¶¨ÏΩîÏùº(${meanX.toFixed(1)}ÌîΩÏÖÄ)ÏùÄ Ï†ÅÏ†àÌï¥ ÏùºÎ∞ò/Ï°∞Ï§Ä Í∞êÎèÑÎäî ÎØ∏ÏÑ∏ Ï°∞Ï†ïÌñàÏäµÎãàÎã§.`;
        } else {
          explanation = `ÏòÅÏÉÅ Î∂ÑÏÑù Í≤∞Í≥º, ÏàòÌèâ Î¶¨ÏΩîÏùº(${meanX.toFixed(1)}ÌîΩÏÖÄ)Í≥º ÏàòÏßÅ Î¶¨ÏΩîÏùº(${meanY.toFixed(1)}ÌîΩÏÖÄ)Ïù¥ Î™©Ìëú(5ÌîΩÏÖÄ)Ïóê Í∞ÄÍπùÏäµÎãàÎã§. Ï†ïÎ∞ÄÎèÑÎ•º ÎÜíÏù¥Í∏∞ ÏúÑÌï¥ Î™®Îì† Í∞êÎèÑÎ•º ${Math.abs(deltaPercent)}% ${deltaPercent > 0 ? 'ÎÜíÏòÄÏäµÎãàÎã§' : 'ÎÇÆÏ∑ÑÏäµÎãàÎã§'}.`;
        }

        const resultHTML = `
          <strong>Ï∂îÏ≤ú Í∞êÎèÑ</strong><br>
          - ÏùºÎ∞ò: ${rec(+generalInput.value)}<br>
          - ÏàòÏßÅ: ${rec(+verticalInput.value)}<br>
          - Ï°∞Ï§Ä: ${rec(+aimInput.value)}<br>
          - Ïä§ÏΩîÌîÑ: ${rec(+scopeInput.value)}<br>
          <div class="result-explanation">${explanation}</div>
          <div class="copy-btn" onclick="copyResults()">Í≤∞Í≥º Î≥µÏÇ¨</div>
        `;
        cachedResult = resultHTML;
        resultDiv.style.display = 'block';
        resultDiv.innerHTML = resultHTML;
        copyFallback.value = `ÏùºÎ∞ò: ${rec(+generalInput.value)}\nÏàòÏßÅ: ${rec(+verticalInput.value)}\nÏ°∞Ï§Ä: ${rec(+aimInput.value)}\nÏä§ÏΩîÌîÑ: ${rec(+scopeInput.value)}`;
        chartsDiv.style.display = 'block';
        copyFallback.style.display = 'none';

        if (sprayChart) sprayChart.destroy();
        if (recoilChart) recoilChart.destroy();

        sprayChart = new Chart('spray-scatter', {
          type: 'scatter',
          data: {
            datasets: [{
              label: 'Ïä§ÌîÑÎ†àÏù¥',
              data: Array.from({length: 50}, () => ({
                x: (Math.random() - 0.5) * 14,
                y: (Math.random() - 0.5) * 20
              })),
              backgroundColor: 'rgba(0, 163, 224, 0.6)'
            }]
          },
          options: {
            plugins: { title: { display: true, text: 'Ïä§ÌîÑÎ†àÏù¥ Ìå®ÌÑ¥' } },
            scales: {
              x: { title: { display: true, text: 'ÏàòÌèâ Ìé∏Ï∞® (ÌîΩÏÖÄ)' } },
              y: { title: { display: true, text: 'ÏàòÏßÅ Ìé∏Ï∞® (ÌîΩÏÖÄ)' } }
            }
          }
        });

        recoilChart = new Chart('recoil-chart', {
          type: 'line',
          data: {
            labels: Array.from({length: 20}, (_, i) => i + 1),
            datasets: [
              { label: '|ŒîY|', data: absY, borderColor: '#00A3E0', fill: false },
              { label: '|ŒîX|', data: absX, borderColor: '#005F9E', fill: false }
            ]
          },
          options: {
            plugins: { title: { display: true, text: 'Î¶¨ÏΩîÏùº Î∂ÑÏÑù' } },
            scales: {
              x: { title: { display: true, text: 'ÌîÑÎ†àÏûÑ' } },
              y: { title: { display: true, text: 'Ìé∏Ï∞® ÌÅ¨Í∏∞ (ÌîΩÏÖÄ)' } }
            }
          }
        });
      } catch (err) {
        console.error('Î∂ÑÏÑù Ïò§Î•ò:', err);
        alert('Î∂ÑÏÑù Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. ÏûÖÎ†• Í∞íÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.');
      }
    });

    function copyResults() {
      const text = `ÏùºÎ∞ò: ${resultDiv.querySelectorAll('br')[1].previousSibling.textContent.split(': ')[1]}\n` +
                   `ÏàòÏßÅ: ${resultDiv.querySelectorAll('br')[2].previousSibling.textContent.split(': ')[1]}\n` +
                   `Ï°∞Ï§Ä: ${resultDiv.querySelectorAll('br')[3].previousSibling.textContent.split(': ')[1]}\n` +
                   `Ïä§ÏΩîÌîÑ: ${resultDiv.querySelectorAll('br')[4].previousSibling.textContent.split(': ')[1]}`;
      
      if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(text).then(() => {
          alert('Í≤∞Í≥ºÍ∞Ä ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!');
          copyFallback.style.display = 'none';
        }).catch(err => {
          console.error('ÌÅ¥Î¶ΩÎ≥¥Îìú Î≥µÏÇ¨ Ïã§Ìå®:', err);
          fallbackCopy(text);
        });
      } else {
        fallbackCopy(text);
      }
    }

    function fallbackCopy(text) {
      copyFallback.style.display = 'block';
      copyFallback.value = text;
      copyFallback.focus();
      copyFallback.select();
      try {
        document.execCommand('copy');
        alert('Í≤∞Í≥ºÍ∞Ä ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!');
        copyFallback.style.display = 'none';
      } catch (err) {
        console.error('ÎåÄÏ≤¥ Î≥µÏÇ¨ Ïã§Ìå®:', err);
        alert('ÌÅ¥Î¶ΩÎ≥¥Îìú Î≥µÏÇ¨Í∞Ä Ïã§Ìå®ÌñàÏäµÎãàÎã§. ÏïÑÎûò ÌÖçÏä§Ìä∏Î•º ÏàòÎèôÏúºÎ°ú Î≥µÏÇ¨Ìï¥Ï£ºÏÑ∏Ïöî.');
      }
    }
  </script>
</body>
</html>
